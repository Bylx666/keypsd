(()=>{var e={603:e=>{e.exports={Parser:class{constructor(e){this.buf=new Uint8Array(e.buffer,e.byteOffset,e.byteLength),this.view=new DataView(e.buffer,e.byteOffset,e.byteLength),this.i=0,this.decoder=new TextDecoder}u8(){return this.i+=1,this.view.getUint8(this.i-1)}i8(){return this.i+=1,this.view.getInt8(this.i-1)}u16(e){return this.i+=2,this.view.getUint16(this.i-2,e)}i16(e){return this.i+=2,this.view.getInt16(this.i-2,e)}u32(e){return this.i+=4,this.view.getUint32(this.i-4,e)}i32(e){return this.i+=4,this.view.getInt32(this.i-4,e)}f32(e){return this.i+=4,this.view.getFloat32(this.i-4,e)}f64(e){return this.i+=8,this.view.getFloat64(this.i-8,e)}skip(e){this.i+=e}skipTo(e){this.i=e}isEnded(){return this.i>=this.buf.byteLength}read(e){return this.i+=e,this.buf.slice(this.i-e,this.i)}str(e){return this.decoder.decode(this.read(e))}unicode(){let e=this.read(2*this.u32());for(let t=0;t<e.byteLength;t+=2)[e[t],e[t+1]]=[e[t+1],e[t]];return String.fromCodePoint.apply(null,new Uint16Array(e.buffer)).replace(/\u0000/g,"")}},Gener:class{constructor(e=1){this.buf=new Uint8Array(e),this.view=new DataView(this.buf.buffer),this.i=0,this.encoder=new TextEncoder}go(e){for(this.i+=e;this.i>=this.buf.byteLength;){let e=this.buf;this.buf=new Uint8Array(2*e.byteLength),this.view=new DataView(this.buf.buffer),this.buf.set(e,0)}}u8(e){this.go(1),this.view.setUint8(this.i-1,e)}i8(e){this.go(1),this.view.setInt8(this.i-1,e)}u16(e){this.go(2),this.view.setUint16(this.i-2,e)}i16(e){this.go(2),this.view.setInt16(this.i-2,e)}u32(e){this.go(4),this.view.setUint32(this.i-4,e)}i32(e){this.go(4),this.view.setInt32(this.i-4,e)}write(e){return this.go(e.byteLength),this.buf.set(e,this.i-e.byteLength),e.byteLength}str(e){return this.write(this.encoder.encode(e))}unicode(e){this.u32(e.length);let t=new DataView(new ArrayBuffer(2*e.length));for(let i=0;i<e.length;++i)t.setUint16(2*i,e.charCodeAt(i));this.write(new Uint8Array(t.buffer))}markSize(){let e=this;e.go(4);let t=e.i;return{i:t,end(){let i=e.i-t;return e.view.setUint32(t-4,i),i}}}export(){return this.buf.subarray(0,this.i)}}}},734:(e,t,i)=>{const{Gener:r}=i(603),n=i(656),{encode0s:s}=i(283);e.exports={gener:function(e){let t=new r(4095);return t.psd=e,t.str("8BPS"),t.u16(1),t.go(6),t.u16(3),t.u32(e.width),t.u32(e.height),t.u16(8),t.u16(3),t.u32(0),t.u32(0),n(t),t.u16(0),t.write(new Uint8Array(e.width*e.height*4)),t.export()},generFrom:function(){}}},656:(e,t,i)=>{const{encode:r}=i(283),n={normal:"norm",darken:"dark",multiply:"mul ","color-burn":"idiv",lighten:"lite",screen:"scrn","color-dodge":"div ",overlay:"over","soft-light":"sLit","hard-light":"hLit",difference:"diff",exclusion:"smud",hue:"hue ",saturation:"sat ",color:"colr",luminosity:"lum "};function s(e,t,i){e.str("8BIM"),e.str(t);let r=e.markSize();i(),r.end()}function o(e,t){let{left:i,top:r,width:o,height:u,image:l,blendMode:a,opacity:h,visible:f,name:d}=t;if(e.u32(r),e.u32(i),e.u32(r+u),e.u32(i+o),l&&l.byteLength){if(l.byteLength!==o*u*4)throw new Error(`'${d}'图层图像大小错误`);e.u16(4),t.channelMetaIndex=e.i,e.go(24)}else e.u16(0);e.str("8BIM"),e.str(n[a]||"norm"),e.u8("number"==typeof h?h:255),e.u8(0),e.u8(!1===f?10:8),e.u8(0),function(e,{name:t,folder:i}){let r=e.markSize();e.u32(0);let n=e.markSize();for(let t=0;t<10;++t)e.u32(65535);n.end(),e.u8(3),e.str("art"),t&&s(e,"luni",(()=>e.unicode(t))),i&&s(e,"lsct",(()=>e.u32("close"===i?3:1))),r.end()}(e,t)}function u(e,{image:t,channelMetaIndex:i,height:n}){if(!t||!t.byteLength)return;let s=t.byteLength/4;for(let o=0;o<4;++o){let u=new Uint8Array(s),l=(o+3)%4;for(let e=0;e<s;++e)u[e]=t[4*e+l];u=r(u),e.u16(1),e.go(2*n),e.write(u);let a=u.byteLength+2*n+2;e.view.setInt16(i+6*o,o-1),e.view.setUint32(i+6*o+2,a)}}e.exports=e=>{let t=e.markSize(),i=e.markSize(),r=e.psd.layers;e.i16(-r.length);for(let t of r)o(e,t);for(let t of r)u(e,t);i.end(),function(e){let t=e.markSize();e.u16(0),e.go(8),e.u16(100),e.u8(128),e.go(3),t.end()}(e),t.end()}},138:(e,t,i)=>{const{gener:r,generFrom:n}=i(734),{parse:s,parseUrl:o}=i(435);e.exports={parse:s,parseUrl:o,gener:r,generFrom:n}},853:e=>{const t={TEXT:e=>e.unicode(),enum:e=>({name:i(e),value:i(e)}),Objc:r,GlbO:r,UntF:e=>(e.skip(4),e.f64()),doub:e=>e.f64(),long:e=>e.i32(),tdta:e=>e.read(e.u32())};let i=e=>e.str(e.u32()||4);function r(e){let i=e.unicode(),r=e.str(e.u32()||4),n=e.u32(),s={name:i,cls:r};for(let i=0;i<n;++i){let i=e.str(e.u32()||4).trim(),r=e.str(4);s[i]=t[r](e)}return s}e.exports=r},800:e=>{const t={3:"RGB"};let i=(e,t)=>{if(!e)throw new Error(t)};e.exports=e=>{i("8BPS"===e.str(4)),e.skip(8);let r=e.u16(),n=e.u32(),s=e.u32(),o=e.u16();i(8===o,"暂时只支持8位深度图像");let u=t[e.u16()];return i(u,"暂时只支持RGB色彩模式"),{channels:r,height:n,width:s,depth:o,mode:u}}},435:(e,t,i)=>{const{Parser:r}=i(603),n=i(800),s=i(380);function o(e){e instanceof ArrayBuffer&&(e=new Uint8Array(e));let t=new r(e),i=n(t);return t.skip(t.u32()),t.skip(t.u32()),i.layers=s(t),i}e.exports={parse:o,parseUrl:async function(e){return o(await(await fetch(e)).arrayBuffer())}}},380:(e,t,i)=>{const r=i(534),n=i(853),{parseEngineData:s}=i(159),o={norm:"normal",dark:"darken",mul:"multiply",idiv:"color-burn",lite:"lighten",scrn:"screen",div:"color-dodge",over:"overlay",sLit:"soft-light",hLit:"hard-light",diff:"difference",smud:"exclusion",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity"};function u(e){const t={luni:()=>({name:e.unicode()}),lyid:()=>(e.skip(4),{id:e.u32()}),lsct:()=>({folder:3===e.u32()?"close":"open"}),TySh(){e.skip(2);let t=new Float64Array(6);for(let i=0;i<6;++i)t[i]=e.f64();e.skip(6);let i=n(e),r=s(i.EngineData);return e.skip(6),n(e),{text:{transform:t,raw:i,chars:r,text:r.text}}}};e.skip(4);let i=e.str(4),r=e.u32(),o=e.i+r,u=t[i]?t[i]():null;return e.skipTo(o),u}function l(e){let t=e.i32(),i=e.i32(),r=e.i32()-t,n=e.i32()-i,s=e.u16(),l=new Array(s);for(let t=0;t<s;++t)l[t]={id:e.i16(),dataLen:e.u32()-2};e.skip(4);let a=o[e.str(4).trim()];a||(a="normal");let h=e.u8();e.skip(1);let f=!(2&e.u8());e.skip(1);let d=e.u32(),c=e.i+d;e.skip(e.u32()),e.skip(e.u32());let g={top:t,left:i,width:n,height:r,name:e.str((e.u8()+1+3&-4)-1),visible:f,blendMode:a,opacity:h,channels:l};for(;e.i<c;)Object.assign(g,u(e));return e.skipTo(c),g}e.exports=e=>{let t=e.u32(),i=e.i+t;e.u32();let n=Math.abs(e.i16()),s=new Array(n);for(let t=0;t<n;++t)s[t]=l(e);return r(e,s),e.skipTo(i),s}},534:(e,t,i)=>{const{decode:r}=i(283);function n(e,t){let{width:i,height:n,channels:s}=t,o=i*n,u=new Uint8Array(4*o);for(let i of s){let s=e.u16();if(!i.dataLen||i.id<-1||s>1)continue;let a=e.read(i.dataLen);switch(1===s&&(a=r(a.subarray(2*n),o)),a.byteLength!==o&&console.warn(`'${t.name}'图层的'${i.id}'通道数据损坏`),i.id){case-1:var l=3;break;case 0:case 1:case 2:l=i.id;break;default:continue}for(let e=0;e<o;++e)u[4*e+l]=a[e]}return u}e.exports=(e,t)=>{for(let i of t)i.image=n(e,i)}},159:e=>{e.exports={parseEngineData:function(e){e=function(e){function t(e){return 32===e||10===e||13===e||9===e}function i(e){return e>=48&&e<=57||46===e||45===e}var r=0;function n(){for(;r<e.length&&t(e[r]);)r++}function s(){var t=e[r];return r++,92===t&&(t=e[r],r++),t}function o(){var t="";if(41===e[r])return r++,t;if(254!==e[r]||255!==e[r+1])throw new Error("Invalid utf-16 BOM");for(r+=2;r<e.length&&41!==e[r];){var i=s()<<8|s();t+=String.fromCharCode(i)}return r++,t}var u=null,l=[];function a(e){l.length?(h(e),l.push(e)):(l.push(e),u=e)}function h(e){if(!l.length)throw new Error("Invalid data");var t=l[l.length-1];if("string"==typeof t)l[l.length-2][t]=e,d();else{if(!Array.isArray(t))throw new Error("Invalid data");t.push(e)}}function f(e){l.length||a({});var t=l[l.length-1];if(t&&"string"==typeof t)h("nil"===e?null:"/".concat(e));else{if(!t||"object"!=typeof t)throw new Error("Invalid data");l.push(e)}}function d(){if(!l.length)throw new Error("Invalid data");l.pop()}for(n();r<e.length;){var c=r,g=e[c];if(60===g&&60===e[c+1])r+=2,a({});else if(62===g&&62===e[c+1])r+=2,d();else if(47===g){for(var w=r+=1;r<e.length&&!t(e[r]);)r++;for(var p="",y=w;y<r;y++)p+=String.fromCharCode(e[y]);f(p)}else if(40===g)r+=1,h(o());else if(91===g)r+=1,a([]);else if(93===g)r+=1,d();else if(110===g&&117===e[c+1]&&108===e[c+2]&&108===e[c+3])r+=4,h(null);else if(116===g&&114===e[c+1]&&117===e[c+2]&&101===e[c+3])r+=4,h(!0);else if(102===g&&97===e[c+1]&&108===e[c+2]&&115===e[c+3]&&101===e[c+4])r+=5,h(!1);else if(i(g)){for(var b="";r<e.length&&i(e[r]);)b+=String.fromCharCode(e[r]),r++;h(parseFloat(b))}else r+=1,console.log("Invalid token ".concat(String.fromCharCode(g)," at ").concat(r));n()}return u}(e);let{Editor:{Text:t},StyleRun:{RunArray:i,RunLengthArray:r}}=e.EngineDict;t=t.replace(/\r/g,"\n");let n=e.ResourceDict.FontSet.map((e=>e.Name)),s=Array.from(t).map(((e,t)=>{for(var s=0;s<i.length&&!((t-=r[s])<0);)s+=1;let o=i[s].StyleSheet.StyleSheetData,u=o.FillColor.Values.map((e=>0|255*e));return u.push(u.shift()),{char:e,color:new Uint8Array(u),font:n[o.Font],size:o.FontSize,underline:!!o.Underline,bold:!!o.FauxBold,italic:!!o.FauxItalic}}));return s.text=t,s}}},283:(e,t,i)=>{const{Gener:r,Parser:n}=i(603);function s(e,t){for(;!e.isEnded();){let i,r=e.u8(),n=-1;for(;!e.isEnded()&&(i=e.u8())===r&&n>-127;)--n;if(-1!==n)t.i8(n-2),t.u8(r),e.i-=1;else{let s=t.i;for(t.go(1),t.u8(r);n<126&&!e.isEnded();){let r=e.u8();if(r===i){e.i-=1;break}t.u8(i),i=r,++n}t.view.setInt8(s,n+1)}}return t.export()}function s(e,t){for(;!e.isEnded();){let i=e.u8();if(e.isEnded()){t.u8(0),t.u8(i);break}let r=e.u8(),n=-1;if(i===r){for(;!e.isEnded()&&(r=e.u8())===i&&n>-127;)n--;if(t.i8(n),t.u8(i),e.isEnded()&&r===i)break}else{let s=t.i;for(t.go(1),t.u8(i);!e.isEnded()&&i!==r&&n<127;)n++,t.u8(r),[i,r]=[r,e.u8()];if(e.isEnded()&&r!==i){t.u8(r),t.view.setInt8(s,n+2);break}t.i--,e.i--,t.view.setInt8(s,n)}e.i--}return t.export()}const o=e=>s(new n(e),new r(e.byteLength));console.log(o(new Uint8Array([2,2,1,2,3,3]))),e.exports={decode:function(e,t){let i=new n(e),s=new r(t);for(;!i.isEnded();){let e=i.i8();if(e>=0)s.write(i.read(1+e));else if(-128!==e){let t=i.u8();s.write(new Uint8Array(1-e).fill(t))}}return s.export()},encode:o,encode0s:function(e){let t=0;return s({isEnded:()=>t<e,u8:()=>(t+=1,0)},new r(0|e/64))}}}},t={},i=function i(r){var n=t[r];if(void 0!==n)return n.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,i),s.exports}(138);keypsd=i})();