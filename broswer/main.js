(()=>{var t={603:t=>{t.exports={Parser:class{constructor(t){this.buf=new Uint8Array(t),this.view=new DataView(t),this.i=0,this.decoder=new TextDecoder}u8(){return this.i+=1,this.view.getUint8(this.i-1)}i8(){return this.i+=1,this.view.getInt8(this.i-1)}u16(t){return this.i+=2,this.view.getUint16(this.i-2,t)}i16(t){return this.i+=2,this.view.getInt16(this.i-2,t)}u32(t){return this.i+=4,this.view.getUint32(this.i-4,t)}i32(t){return this.i+=4,this.view.getInt32(this.i-4,t)}f32(t){return this.i+=4,this.view.getFloat32(this.i-4,t)}f64(t){return this.i+=8,this.view.getFloat64(this.i-8,t)}skip(t){this.i+=t}skipTo(t){this.i=t}read(t){return this.i+=t,this.buf.slice(this.i-t,this.i)}str(t){return this.decoder.decode(this.read(t))}unicode(){let t=this.read(2*this.u32());for(let e=0;e<t.byteLength;e+=2)[t[e],t[e+1]]=[t[e+1],t[e]];return String.fromCodePoint.apply(null,new Uint16Array(t.buffer)).replace(/\u0000/g,"")}},Gener:class{constructor(t=1,e=!0){this.buf=new Uint8Array(t),this.view=new DataView(this.buf.buffer),this.i=0,this.encoder=new TextEncoder,this.le=e}go(t){for(this.i+=t;this.i>=this.buf.byteLength;){let t=this.buf;this.buf=new Uint8Array(2*t.byteLength),this.view=new DataView(this.buf.buffer),this.buf.set(t,0)}}u8(t){this.go(1),this.view.setUint8(this.i-1,t)}i8(t){this.go(1),this.view.setInt8(this.i-1,t)}u16(t){this.go(2),this.view.setUint16(this.i-2,t,this.le)}i16(t){this.go(2),this.view.setInt16(this.i-2,t,this.le)}u32(t){this.go(4),this.view.setUint32(this.i-4,t,this.le)}i32(t){this.go(4),this.view.setInt32(this.i-4,t,this.le)}write(t){return this.go(t.byteLength),this.buf.set(t,this.i-t.byteLength),t.byteLength}str(t){return this.write(this.encoder.encode(t))}export(){return this.buf.subarray(0,this.i)}}}},138:(t,e,i)=>{const{parse:r,parse_url:n}=i(435);t.exports={parse:r,parse_url:n}},853:t=>{const e={TEXT:t=>t.unicode(),enum:t=>({name:i(t),value:i(t)}),Objc:r,GlbO:r,UntF:t=>(t.skip(4),t.f64()),doub:t=>t.f64(),long:t=>t.i32(),tdta:t=>t.read(t.u32())};let i=t=>t.str(t.u32()||4);function r(t){let i=t.unicode(),r=t.str(t.u32()||4),n=t.u32(),s={name:i,cls:r};for(let i=0;i<n;++i){let i=t.str(t.u32()||4).trim(),r=t.str(4);s[i]=e[r](t)}return s}t.exports=r},800:t=>{const e={3:"RGB"};let i=(t,e)=>{if(!t)throw new Error(e||"文件头解析错误")};t.exports=t=>{i("8BPS"===t.str(4)),t.skip(8);let r=t.u16(),n=t.u32(),s=t.u32(),o=t.u16();i(8===o,"暂时只支持8位深度图像");let a=e[t.u16()];return i(a,"暂时只支持RGB色彩模式"),{channels:r,height:n,width:s,depth:o,mode:a}}},435:(t,e,i)=>{const{Parser:r}=i(603),n=i(800),s=i(380);function o(t){let e=new r(t,!0),i=n(e);return e.skip(e.u32()),e.skip(e.u32()),i.layers=s(e),i}t.exports={parse:o,parse_url:async function(t){return o(await(await fetch(t)).arrayBuffer())}}},380:(t,e,i)=>{const r=i(534),n=i(853),{parseEngineData:s}=i(159),o={norm:"normal",dark:"darken",mul:"multiply",idiv:"color-burn",lite:"lighten",scrn:"screen",div:"color-dodge",over:"overlay",sLit:"soft-light",hLit:"hard-light",diff:"difference",smud:"exclusion",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity"};let{log:a}=console;function l(t){const e={luni:()=>({name:t.unicode()}),lyid:()=>(t.skip(4),{id:t.u32()}),lsct:()=>({folder:3===t.u32()?"close":"open"}),TySh(){t.skip(2);let e=new Float64Array(6);for(let i=0;i<6;++i)e[i]=t.f64();t.skip(6);let i=n(t),r=s(i.EngineData);return t.skip(6),n(t),{text:{transform:e,raw:i,chars:r}}}};t.skip(4);let i=t.str(4),r=t.u32(),o=t.i+r,a=e[i]?e[i]():null;return t.skipTo(o),a}function u(t){let e=t.i32(),i=t.i32(),r=t.i32()-e,n=t.i32()-i,s=t.u16(),a=new Array(s);for(let e=0;e<s;++e)a[e]={id:t.i16(),dataLen:t.u32()-2};t.skip(4);let u=o[t.str(4).trim()];u||(u="normal");let h=t.u8();t.skip(3);let f=t.u32(),c=t.i+f;t.skip(t.u32()),t.skip(t.u32());let d={top:e,left:i,width:n,height:r,name:t.str((t.u8()+1+3&-4)-1),blendMode:u,opacity:h,channels:a};for(;t.i<c;)Object.assign(d,l(t));return t.skipTo(c),d}t.exports=t=>{let e=t.u32(),i=t.i+e;t.u32();let n=Math.abs(t.i16()),s=new Array(n);for(let e=0;e<n;++e)s[e]=u(t);return r(t,s),t.skipTo(i),s.reverse()}},534:(t,e,i)=>{const{Gener:r,Parser:n}=i(603),{log:s}=console;function o(t,e){let{width:i,height:r,channels:n}=e,s=i*r,o=new Uint8Array(4*s);for(let u of n){let n=t.u16();if(!u.dataLen||u.id<-1||n>1)continue;let h=t.read(u.dataLen);switch(1===n&&(h=a(h,i,r)),h.byteLength!==s&&console.warn(`'${e.name}'图层的'${u.id}'通道数据损坏`),u.id){case-1:var l=3;break;case 0:case 1:case 2:l=u.id;break;default:continue}for(let t=0;t<s;++t)o[4*t+l]=h[t]}return o}function a(t,e,i){let s=t.byteLength,o=new n(t.buffer),a=new r(e*i);for(o.skip(2*i);o.i<s;){let t=o.i8();if(t>=0)a.write(o.read(1+t));else if(-128!==t){let e=o.u8();a.write(new Uint8Array(1-t).fill(e))}}return a.export()}t.exports=(t,e)=>{for(let i of e)i.image=o(t,i)}},159:t=>{t.exports={parseEngineData:function(t){t=function(t){function e(t){return 32===t||10===t||13===t||9===t}function i(t){return t>=48&&t<=57||46===t||45===t}var r=0;function n(){for(;r<t.length&&e(t[r]);)r++}function s(){var e=t[r];return r++,92===e&&(e=t[r],r++),e}function o(){var e="";if(41===t[r])return r++,e;if(254!==t[r]||255!==t[r+1])throw new Error("Invalid utf-16 BOM");for(r+=2;r<t.length&&41!==t[r];){var i=s()<<8|s();e+=String.fromCharCode(i)}return r++,e}var a=null,l=[];function u(t){l.length?(h(t),l.push(t)):(l.push(t),a=t)}function h(t){if(!l.length)throw new Error("Invalid data");var e=l[l.length-1];if("string"==typeof e)l[l.length-2][e]=t,c();else{if(!Array.isArray(e))throw new Error("Invalid data");e.push(t)}}function f(t){l.length||u({});var e=l[l.length-1];if(e&&"string"==typeof e)h("nil"===t?null:"/".concat(t));else{if(!e||"object"!=typeof e)throw new Error("Invalid data");l.push(t)}}function c(){if(!l.length)throw new Error("Invalid data");l.pop()}for(n();r<t.length;){var d=r,g=t[d];if(60===g&&60===t[d+1])r+=2,u({});else if(62===g&&62===t[d+1])r+=2,c();else if(47===g){for(var p=r+=1;r<t.length&&!e(t[r]);)r++;for(var w="",v=p;v<r;v++)w+=String.fromCharCode(t[v]);f(w)}else if(40===g)r+=1,h(o());else if(91===g)r+=1,u([]);else if(93===g)r+=1,c();else if(110===g&&117===t[d+1]&&108===t[d+2]&&108===t[d+3])r+=4,h(null);else if(116===g&&114===t[d+1]&&117===t[d+2]&&101===t[d+3])r+=4,h(!0);else if(102===g&&97===t[d+1]&&108===t[d+2]&&115===t[d+3]&&101===t[d+4])r+=5,h(!1);else if(i(g)){for(var y="";r<t.length&&i(t[r]);)y+=String.fromCharCode(t[r]),r++;h(parseFloat(y))}else r+=1,console.log("Invalid token ".concat(String.fromCharCode(g)," at ").concat(r));n()}return a}(t);let{Editor:{Text:e},StyleRun:{RunArray:i,RunLengthArray:r}}=t.EngineDict;e=e.replace(/\r/g,"\n");let n=t.ResourceDict.FontSet.map((t=>t.Name));return Array.from(e).map(((t,s)=>{for(var o=0;o<i.length&&!((s-=r[o])<0);)o+=1;let a=i[o].StyleSheet.StyleSheetData;return{char:t,text:e,color:a.FillColor.Values.map((t=>0|255*t)),font:n[a.Font],size:a.FontSize,underline:!!a.Underline,bold:!!a.FauxBold,italic:!!a.FauxItalic}}))}}}},e={},i=function i(r){var n=e[r];if(void 0!==n)return n.exports;var s=e[r]={exports:{}};return t[r](s,s.exports,i),s.exports}(138);psd=i})();