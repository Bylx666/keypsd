(()=>{var t={603:t=>{t.exports={Parser:class{constructor(t){this.buf=new Uint8Array(t),this.view=new DataView(t),this.i=0,this.decoder=new TextDecoder}u8(){return this.i+=1,this.view.getUint8(this.i-1)}i8(){return this.i+=1,this.view.getInt8(this.i-1)}u16(t){return this.i+=2,this.view.getUint16(this.i-2,t)}i16(t){return this.i+=2,this.view.getInt16(this.i-2,t)}u32(t){return this.i+=4,this.view.getUint32(this.i-4,t)}i32(t){return this.i+=4,this.view.getInt32(this.i-4,t)}skip(t){this.i+=t}skipTo(t){this.i=t}read(t){return this.i+=t,this.buf.slice(this.i-t,this.i)}str(t){return this.decoder.decode(this.read(t))}utf16be(t){let e=this.read(2*t);for(let t=0;t<e.byteLength;t+=2)[e[t],e[t+1]]=[e[t+1],e[t]];return String.fromCodePoint.apply(null,new Uint16Array(e.buffer)).replace(/\u0000/g,"")}},Gener:class{constructor(t=1,e=!0){this.buf=new Uint8Array(t),this.view=new DataView(this.buf.buffer),this.i=0,this.encoder=new TextEncoder,this.le=e}go(t){for(this.i+=t;this.i>=this.buf.byteLength;){let t=this.buf;this.buf=new Uint8Array(2*t.byteLength),this.view=new DataView(this.buf.buffer),this.buf.set(t,0)}}u8(t){this.go(1),this.view.setUint8(this.i-1,t)}i8(t){this.go(1),this.view.setInt8(this.i-1,t)}u16(t){this.go(2),this.view.setUint16(this.i-2,t,this.le)}i16(t){this.go(2),this.view.setInt16(this.i-2,t,this.le)}u32(t){this.go(4),this.view.setUint32(this.i-4,t,this.le)}i32(t){this.go(4),this.view.setInt32(this.i-4,t,this.le)}write(t){return this.go(t.byteLength),this.buf.set(t,this.i-t.byteLength),t.byteLength}str(t){return this.write(this.encoder.encode(t))}export(){return this.buf.subarray(0,this.i)}}}},138:(t,e,i)=>{const{parse:r,parse_url:s}=i(435),n=i(747);t.exports={parse:r,parse_url:s,wasm:n}},800:t=>{const e={3:"RGB"};let i=(t,e)=>{if(!t)throw new Error(e||"文件头解析错误")};t.exports=t=>{i("8BPS"===t.str(4)),t.skip(8);let r=t.u16(),s=t.u32(),n=t.u32(),o=t.u16();i(8===o,"暂时只支持8位深度图像");let h=e[t.u16()];return i(h,"暂时只支持RGB色彩模式"),{channels:r,height:s,width:n,depth:o,mode:h}}},435:(t,e,i)=>{const{Parser:r}=i(603),s=i(800),n=i(380);function o(t){let e=new r(t,!0),i=s(e);return e.skip(e.u32()),e.skip(e.u32()),i.layers=n(e),i}t.exports={parse:o,parse_url:async function(t){return o(await(await fetch(t)).arrayBuffer())}}},380:(t,e,i)=>{const r=i(534),s={norm:"normal",dark:"darken",mul:"multiply",idiv:"color-burn",lite:"lighten",scrn:"screen",div:"color-dodge",over:"overlay",sLit:"soft-light",hLit:"hard-light",diff:"difference",smud:"exclusion",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity"};let{log:n}=console;function o(t){const e={luni(){let e=t.u32();return{name:t.utf16be(e)}},lsct:()=>({folder:3===t.u32()?"close":"open"})};t.skip(4);let i=t.str(4),r=t.u32(),s=t.i+r,n=e[i]?e[i]():null;return t.skipTo(s),n}function h(t){let e=t.i32(),i=t.i32(),r=t.i32()-e,n=t.i32()-i,h=t.u16(),u=new Array(h);for(let e=0;e<h;++e)u[e]={id:t.i16(),dataLen:t.u32()-2};t.skip(4);let a=s[t.str(4).trim()];a||(a="normal");let l=t.u8();t.skip(3);let f=t.u32(),c=t.i+f;t.skip(t.u32()),t.skip(t.u32());let w={top:e,left:i,width:n,height:r,name:t.str((t.u8()+1+3&-4)-1),blendMode:a,opacity:l,channels:u};for(;t.i<c;)Object.assign(w,o(t));return t.skipTo(c),w}t.exports=t=>{let e=t.u32(),i=t.i+e;t.u32();let s=Math.abs(t.i16()),n=new Array(s);for(let e=0;e<s;++e)n[e]=h(t);return r(t,n),t.skipTo(i),n}},534:(t,e,i)=>{const r=i(747),{Gener:s}=i(603),{log:n}=console;t.exports=(t,e)=>{let{memory:i,alloc:n,dealloc:o,getLayerRgba:h}=r.get();for(let r of e){let{width:e,height:u,channels:a}=r,l=new s(128,!0);l.go(4),l.u32(e),l.u32(u);let f=0,c=l.i;l.u16(0);for(let e of a){let i=t.u16();if(!e.dataLen||e.id<-1||i>1)continue;f+=1;let r=t.read(e.dataLen);l.i8(e.id),l.u8(i),l.u32(r.byteLength),l.write(r)}l.view.setUint32(0,l.i,!0),l.view.setUint16(c,f,!0);let w=l.export(),d=n(w.byteLength);new Uint8Array(i.buffer,d).set(w);let p=h(d),g=e*u*4;r.image=new Uint8Array(i.buffer,p,g).slice(),o(p,g)}}},747:t=>{const e={console:{log(t){let e=new Uint8Array(i.memory.buffer,r,t);console.log(s.decode(e))}}};let i,r,s=new TextDecoder;t.exports={init:async function(t){if(t instanceof Promise&&(t=await t),t instanceof Response&&(t=await t.arrayBuffer()),t instanceof Uint8Array&&(t=t.buffer),!t instanceof ArrayBuffer)throw new TypeError("只允许fetch或ArrayBuffer作为wasm源");i=(await WebAssembly.instantiate(t,e)).instance.exports,r=i.setPanicHook()},get:()=>i}}},e={},i=function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}(138);psd=i})();