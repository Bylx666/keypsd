(()=>{var t={603:t=>{t.exports={Parser:class{constructor(t){this.buf=new Uint8Array(t),this.view=new DataView(t),this.i=0,this.decoder=new TextDecoder}u8(){return this.i+=1,this.view.getUint8(this.i-1)}i8(){return this.i+=1,this.view.getInt8(this.i-1)}u16(t){return this.i+=2,this.view.getUint16(this.i-2,t)}i16(t){return this.i+=2,this.view.getInt16(this.i-2,t)}u32(t){return this.i+=4,this.view.getUint32(this.i-4,t)}i32(t){return this.i+=4,this.view.getInt32(this.i-4,t)}skip(t){this.i+=t}skipTo(t){this.i=t}read(t){return this.i+=t,this.buf.slice(this.i-t,this.i)}str(t){return this.decoder.decode(this.read(t))}utf16be(t){let e=this.read(2*t);for(let t=0;t<e.byteLength;t+=2)[e[t],e[t+1]]=[e[t+1],e[t]];return String.fromCodePoint.apply(null,new Uint16Array(e.buffer)).replace(/\u0000/g,"")}},Gener:class{constructor(t=1,e=!0){this.buf=new Uint8Array(t),this.view=new DataView(this.buf.buffer),this.i=0,this.encoder=new TextEncoder,this.le=e}go(t){for(this.i+=t;this.i>=this.buf.byteLength;){let t=this.buf;this.buf=new Uint8Array(2*t.byteLength),this.view=new DataView(this.buf.buffer),this.buf.set(t,0)}}u8(t){this.go(1),this.view.setUint8(this.i-1,t)}i8(t){this.go(1),this.view.setInt8(this.i-1,t)}u16(t){this.go(2),this.view.setUint16(this.i-2,t,this.le)}i16(t){this.go(2),this.view.setInt16(this.i-2,t,this.le)}u32(t){this.go(4),this.view.setUint32(this.i-4,t,this.le)}i32(t){this.go(4),this.view.setInt32(this.i-4,t,this.le)}write(t){return this.go(t.byteLength),this.buf.set(t,this.i-t.byteLength),t.byteLength}str(t){return this.write(this.encoder.encode(t))}export(){return this.buf.subarray(0,this.i)}}}},138:(t,e,i)=>{const{parse:r,parse_url:s}=i(435);t.exports={parse:r,parse_url:s}},800:t=>{const e={3:"RGB"};let i=(t,e)=>{if(!t)throw new Error(e||"文件头解析错误")};t.exports=t=>{i("8BPS"===t.str(4)),t.skip(8);let r=t.u16(),s=t.u32(),n=t.u32(),h=t.u16();i(8===h,"暂时只支持8位深度图像");let o=e[t.u16()];return i(o,"暂时只支持RGB色彩模式"),{channels:r,height:s,width:n,depth:h,mode:o}}},435:(t,e,i)=>{const{Parser:r}=i(603),s=i(800),n=i(380);function h(t){let e=new r(t,!0),i=s(e);return e.skip(e.u32()),e.skip(e.u32()),i.layers=n(e),i}t.exports={parse:h,parse_url:async function(t){return h(await(await fetch(t)).arrayBuffer())}}},380:(t,e,i)=>{const r=i(534),s={norm:"normal",dark:"darken",mul:"multiply",idiv:"color-burn",lite:"lighten",scrn:"screen",div:"color-dodge",over:"overlay",sLit:"soft-light",hLit:"hard-light",diff:"difference",smud:"exclusion",hue:"hue",sat:"saturation",colr:"color",lum:"luminosity"};let{log:n}=console;function h(t){const e={luni(){let e=t.u32();return{name:t.utf16be(e)}},lsct:()=>({folder:3===t.u32()?"close":"open"})};t.skip(4);let i=t.str(4),r=t.u32(),s=t.i+r,n=e[i]?e[i]():null;return t.skipTo(s),n}function o(t){let e=t.i32(),i=t.i32(),r=t.i32()-e,n=t.i32()-i,o=t.u16(),u=new Array(o);for(let e=0;e<o;++e)u[e]={id:t.i16(),dataLen:t.u32()-2};t.skip(4);let l=s[t.str(4).trim()];l||(l="normal");let a=t.u8();t.skip(3);let f=t.u32(),c=t.i+f;t.skip(t.u32()),t.skip(t.u32());let w={top:e,left:i,width:n,height:r,name:t.str((t.u8()+1+3&-4)-1),blendMode:l,opacity:a,channels:u};for(;t.i<c;)Object.assign(w,h(t));return t.skipTo(c),w}t.exports=t=>{let e=t.u32(),i=t.i+e;t.u32();let s=Math.abs(t.i16()),n=new Array(s);for(let e=0;e<s;++e)n[e]=o(t);return r(t,n),t.skipTo(i),n}},534:(t,e,i)=>{const{Gener:r,Parser:s}=i(603),{log:n}=console;function h(t,e){let{width:i,height:r,channels:s}=e,n=i*r,h=new Uint8Array(4*n);for(let l of s){let s=t.u16();if(!l.dataLen||l.id<-1||s>1)continue;let a=t.read(l.dataLen);switch(1===s&&(a=o(a,i,r)),a.byteLength!==n&&console.warn(`'${e.name}'图层的'${l.id}'通道数据损坏`),l.id){case-1:var u=3;break;case 0:case 1:case 2:u=l.id;break;default:continue}for(let t=0;t<n;++t)h[4*t+u]=a[t]}return h}function o(t,e,i){let n=t.byteLength,h=new s(t.buffer),o=new r(e*i);for(h.skip(2*i);h.i<n;){let t=h.i8();if(t>=0)o.write(h.read(1+t));else if(-128!==t){let e=h.u8();o.write(new Uint8Array(1-t).fill(e))}}return o.export()}t.exports=(t,e)=>{for(let i of e)i.image=h(t,i)}}},e={},i=function i(r){var s=e[r];if(void 0!==s)return s.exports;var n=e[r]={exports:{}};return t[r](n,n.exports,i),n.exports}(138);psd=i})();